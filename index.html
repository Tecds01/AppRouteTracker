<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Route Tracker</title>
    <style>
        :root {
            --primary-color: #007AFF;
            --secondary-color: #34C759;
            --background-color: #F2F2F7;
            --card-color: #FFFFFF;
            --text-color: #1C1C1E;
            --secondary-text: #8E8E93;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background-color: var(--background-color);
            color: var(--text-color);
            padding-bottom: 80px;
            -webkit-text-size-adjust: 100%;
        }
        
        header {
            background-color: var(--card-color);
            padding: 15px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 22px;
            font-weight: 600;
        }
        
        .tabs {
            display: flex;
            background-color: var(--card-color);
            margin-bottom: 10px;
            position: sticky;
            top: 60px;
            z-index: 9;
        }
        
        .tab {
            flex: 1;
            text-align: center;
            padding: 15px 0;
            font-size: 16px;
            color: var(--secondary-text);
            border-bottom: 2px solid transparent;
            cursor: pointer;
            user-select: none;
        }
        
        .tab.active {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            font-weight: 500;
        }
        
        .container {
            padding: 15px;
        }
        
        .card {
            background-color: var(--card-color);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .calendar {
            width: 100%;
            border-collapse: collapse;
        }
        
        .calendar th {
            font-size: 14px;
            font-weight: 400;
            color: var(--secondary-text);
            padding: 5px;
        }
        
        .calendar td {
            text-align: center;
            padding: 8px 5px;
            font-size: 16px;
        }
        
        .calendar .current-day {
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .search-input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #D1D1D6;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
            -webkit-appearance: none;
        }
        
        .time-input {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .time-input label {
            flex: 1;
            font-size: 16px;
        }
        
        .time-input input {
            padding: 8px 12px;
            border: 1px solid #D1D1D6;
            border-radius: 8px;
            font-size: 16px;
            width: 80px;
            text-align: center;
            -webkit-appearance: none;
        }
        
        .time-input button {
            margin-left: 10px;
            padding: 8px 12px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
        }
        
        .client-info {
            margin-bottom: 20px;
            border: 1px solid #D1D1D6;
            border-radius: 8px;
            padding: 15px;
            position: relative;
        }
        
        .client-info label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: var(--secondary-text);
        }
        
        .client-info input, .client-info textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #D1D1D6;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 10px;
            -webkit-appearance: none;
        }
        
        .client-info textarea {
            min-height: 80px;
        }
        
        .remove-client {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: #FF3B30;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            font-size: 14px;
            cursor: pointer;
        }
        
        .button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: 500;
            width: 100%;
            cursor: pointer;
        }
        
        .button.secondary {
            background-color: var(--secondary-color);
            margin-top: 10px;
        }
        
        .button.tertiary {
            background-color: #FF9500;
            margin-top: 10px;
        }
        
        .summary-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        .summary-table th, .summary-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #D1D1D6;
        }
        
        .summary-table th {
            color: var(--secondary-text);
            font-weight: 400;
        }
        
        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .stat-card {
            background-color: var(--card-color);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .stat-label {
            font-size: 14px;
            color: var(--secondary-text);
        }
        
        .checkpoint {
            display: flex;
            margin-bottom: 15px;
        }
        
        .checkpoint-time {
            font-weight: 500;
            min-width: 70px;
        }
        
        .checkpoint-details {
            flex: 1;
            padding-left: 10px;
        }
        
        .checkpoint-address {
            color: var(--secondary-text);
            font-size: 14px;
        }
        
        .no-data {
            text-align: center;
            color: var(--secondary-text);
            padding: 20px 0;
            font-size: 16px;
        }
        
        .lunch-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 30px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--secondary-color);
        }
        
        input:checked + .slider:before {
            transform: translateX(20px);
        }
        
        .hidden {
            display: none;
        }
        
        .client-block {
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <header>
        <h1>Route Tracker</h1>
    </header>
    
    <div class="tabs">
        <div class="tab active" data-tab="routes">Rotas</div>
        <div class="tab" data-tab="hours">Horas</div>
        <div class="tab" data-tab="history">Histórico</div>
    </div>
    
    <!-- Rotas Tab -->
    <div id="routes-tab" class="container">
        <div class="card">
            <h2 class="card-title">Checkpoints da Rota</h2>
            
            <div class="checkpoint">
                <div class="checkpoint-time">
                    <input type="time" id="start-time" value="08:00">
                    <button class="gps-btn" onclick="getGPSLocation('start-time')">GPS</button>
                </div>
                <div class="checkpoint-details">
                    <div>Início</div>
                    <div class="checkpoint-address" id="start-address">Endereço de início</div>
                </div>
            </div>
            
            <div class="lunch-toggle">
                <div>Fez pausa para almoço?</div>
                <label class="toggle-switch">
                    <input type="checkbox" id="lunch-toggle">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div id="client-blocks">
                <!-- Client blocks will be added here dynamically -->
            </div>
            
            <button class="button tertiary" id="add-client-btn">+ Adicionar Cliente</button>
            
            <div class="checkpoint">
                <div class="checkpoint-time">
                    <input type="time" id="end-time" value="17:00">
                    <button class="gps-btn" onclick="getGPSLocation('end-time')">GPS</button>
                </div>
                <div class="checkpoint-details">
                    <div>Fim</div>
                    <div class="checkpoint-address" id="end-address">Endereço de término</div>
                </div>
            </div>
            
            <button class="button" id="save-btn">SALVAR</button>
        </div>
    </div>
    
    <!-- Horas Tab -->
    <div id="hours-tab" class="container hidden">
        <div class="card">
            <h2 class="card-title">Horas Diárias</h2>
            
            <div class="time-input">
                <label>Total de Horas</label>
                <input type="text" value="0h 00m" readonly id="total-hours-day">
            </div>
            
            <div class="time-input">
                <label>Horas Trabalhadas</label>
                <input type="text" value="0h 00m" readonly id="worked-hours">
            </div>
        </div>
        
        <div class="card">
            <h2 class="card-title">Resumo Mensal</h2>
            
            <table class="summary-table">
                <tr>
                    <th>DATA</th>
                    <th>HORAS</th>
                </tr>
                <tr>
                    <td colspan="2" class="no-data">Nenhuma rota registrada este mês</td>
                </tr>
            </table>
        </div>
        
        <div class="card">
            <h2 class="card-title">Total Mensal</h2>
            <div class="stat-value">0h 00m</div>
        </div>
    </div>
    
    <!-- Histórico Tab -->
    <div id="history-tab" class="container hidden">
        <div class="card">
            <h2 class="card-title">Histórico de Rotas</h2>
            
            <div class="card">
                <h3 class="card-title">Calendário</h3>
                <p>Selecione uma data para ver as rotas</p>
                
                <table class="calendar">
                    <thead>
                        <tr>
                            <th>dom</th>
                            <th>seg</th>
                            <th>ter</th>
                            <th>qua</th>
                            <th>qui</th>
                            <th>sex</th>
                            <th>sab</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>23</td>
                            <td>24</td>
                            <td>25</td>
                            <td>26</td>
                            <td><span class="current-day">27</span></td>
                            <td>28</td>
                            <td>1</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>3</td>
                            <td>4</td>
                            <td>5</td>
                            <td>6</td>
                            <td>7</td>
                            <td>8</td>
                        </tr>
                        <tr>
                            <td>9</td>
                            <td>10</td>
                            <td>11</td>
                            <td>12</td>
                            <td>13</td>
                            <td>14</td>
                            <td>15</td>
                        </tr>
                        <tr>
                            <td>16</td>
                            <td>17</td>
                            <td>18</td>
                            <td>19</td>
                            <td>20</td>
                            <td>21</td>
                            <td>22</td>
                        </tr>
                        <tr>
                            <td>23</td>
                            <td>24</td>
                            <td>25</td>
                            <td>26</td>
                            <td>27</td>
                            <td>28</td>
                            <td>29</td>
                        </tr>
                        <tr>
                            <td>30</td>
                            <td>31</td>
                            <td>1</td>
                            <td>2</td>
                            <td>3</td>
                            <td>4</td>
                            <td>5</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="card">
                <h3 class="card-title">Filtro</h3>
                <p>Buscar por cliente, endereço ou notas</p>
                <input type="text" class="search-input" placeholder="Buscar..." id="history-search">
                <p id="selected-date">Data selecionada: 27/03/2025</p>
                <p>0 rotas encontradas</p>
            </div>
            
            <div class="card">
                <h3 class="card-title">Rotas em 27/03/2025</h3>
                <p class="no-data">Nenhuma rota encontrada para esta data</p>
            </div>
        </div>
    </div>
    
    <script>
        // Client block template
        const clientBlockTemplate = `
        <div class="client-block">
            <div class="checkpoint">
                <div class="checkpoint-time">
                    <input type="time" class="client-arrival-time" value="12:00">
                    <button class="gps-btn" onclick="getGPSLocation(this)">GPS</button>
                </div>
                <div class="checkpoint-details">
                    <div>Chegada no Cliente</div>
                    <div class="checkpoint-address client-arrival-address">Endereço do cliente</div>
                </div>
            </div>
            
            <div class="client-info">
                <button class="remove-client" onclick="removeClientBlock(this)">×</button>
                <div>
                    <label>Nome do Cliente</label>
                    <input type="text" class="client-name" placeholder="Digite o nome do cliente">
                </div>
                
                <div>
                    <label>Endereço do Cliente</label>
                    <input type="text" class="client-address" placeholder="Digite o endereço do cliente">
                </div>
                
                <div>
                    <label>Notas do Serviço</label>
                    <textarea class="service-notes" placeholder="Adicione notas sobre o serviço"></textarea>
                </div>
            </div>
            
            <div class="checkpoint">
                <div class="checkpoint-time">
                    <input type="time" class="client-departure-time" value="13:00">
                    <button class="gps-btn" onclick="getGPSLocation(this)">GPS</button>
                </div>
                <div class="checkpoint-details">
                    <div>Saída do Cliente</div>
                    <div class="checkpoint-address client-departure-address">Endereço do cliente</div>
                </div>
            </div>
        </div>
        `;
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function(e) {
                    const tabName = this.getAttribute('data-tab');
                    showTab(tabName, e);
                });
            });
            
            // Add first client block
            addClientBlock();
            
            // Add event listeners
            document.getElementById('add-client-btn').addEventListener('click', addClientBlock);
            document.getElementById('save-btn').addEventListener('click', saveRoute);
            document.getElementById('lunch-toggle').addEventListener('change', calculateHours);
            
            // Time inputs that should trigger calculation
            document.getElementById('start-time').addEventListener('change', calculateHours);
            document.getElementById('end-time').addEventListener('change', calculateHours);
            
            // Set current date
            updateCurrentDate();
            
            // Focus on inputs when tapped (iOS fix)
            const inputs = document.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                input.addEventListener('touchstart', function() {
                    this.focus();
                });
            });
        });
        
        // Show/hide tabs
        function showTab(tabName, event) {
            // Hide all tabs
            document.getElementById('routes-tab').classList.add('hidden');
            document.getElementById('hours-tab').classList.add('hidden');
            document.getElementById('history-tab').classList.add('hidden');
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            
            // Add active class to selected tab
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('active');
            }
            
            // If showing hours tab, update calculations
            if (tabName === 'hours') {
                calculateHours();
            }
        }
        
        // Add a new client block
        function addClientBlock() {
            const clientBlocks = document.getElementById('client-blocks');
            const newBlock = document.createElement('div');
            newBlock.innerHTML = clientBlockTemplate;
            clientBlocks.appendChild(newBlock);
            
            // Add event listeners to new time inputs
            const timeInputs = newBlock.querySelectorAll('input[type="time"]');
            timeInputs.forEach(input => {
                input.addEventListener('change', calculateHours);
            });
        }
        
        // Remove a client block
        function removeClientBlock(button) {
            const clientBlock = button.closest('.client-block');
            if (document.querySelectorAll('.client-block').length > 1) {
                clientBlock.remove();
                calculateHours();
            } else {
                alert("Você precisa ter pelo menos um cliente cadastrado.");
            }
        }
        
        // Calculate worked hours
        function calculateHours() {
            const startTime = document.getElementById('start-time').value;
            const endTime = document.getElementById('end-time').value;
            const lunchBreak = document.getElementById('lunch-toggle').checked;
            
            if (!startTime || !endTime) return;
            
            // Calculate total hours
            const start = new Date(`2000-01-01T${startTime}`);
            const end = new Date(`2000-01-01T${endTime}`);
            
            let diffMs = end - start;
            if (diffMs < 0) {
                // Handle overnight (just add 24 hours)
                diffMs += 24 * 60 * 60 * 1000;
            }
            
            const diffMins = Math.floor(diffMs / 60000);
            const hours = Math.floor(diffMins / 60);
            const mins = diffMins % 60;
            
            // Display total hours
            document.getElementById('total-hours-day').value = `${hours}h ${mins.toString().padStart(2, '0')}m`;
            
            // Calculate worked hours (subtract 1h if lunch break)
            let workedHours = diffMins;
            if (lunchBreak) {
                workedHours = Math.max(0, workedHours - 60); // Subtract 1 hour
            }
            
            const workedH = Math.floor(workedHours / 60);
            const workedM = workedHours % 60;
            
            // Display worked hours
            document.getElementById('worked-hours').value = `${workedH}h ${workedM.toString().padStart(2, '0')}m`;
        }
        
        // Simulate GPS location (in a real app, this would use the Geolocation API)
        function getGPSLocation(element) {
            // This is a simulation - in a real app, you would use:
            // navigator.geolocation.getCurrentPosition()
            
            let timeInput;
            if (typeof element === 'string') {
                // If element is an ID
                timeInput = document.getElementById(element);
            } else {
                // If element is a button next to the input
                timeInput = element.parentElement.querySelector('input[type="time"]');
            }
            
            // Set current time
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const mins = now.getMinutes().toString().padStart(2, '0');
            timeInput.value = `${hours}:${mins}`;
            
            // Simulate address (in real app, you would reverse geocode the coordinates)
            let addressElement;
            if (element === 'start-time') {
                addressElement = document.getElementById('start-address');
                addressElement.textContent = "Endereço de início via GPS";
            } else if (element === 'end-time') {
                addressElement = document.getElementById('end-address');
                addressElement.textContent = "Endereço de término via GPS";
            } else {
                addressElement = element.closest('.checkpoint').querySelector('.checkpoint-address');
                addressElement.textContent = "Endereço do cliente via GPS";
            }
            
            // Recalculate hours if needed
            if (timeInput.id === 'start-time' || timeInput.id === 'end-time') {
                calculateHours();
            }
            
            alert("Localização obtida via GPS e hora definida para agora.");
        }
        
        // Save route data
        function saveRoute() {
            // In a real app, this would save to localStorage or a backend
            alert("Rota salva com sucesso!");
            calculateHours();
        }
        
        // Update current date display
        function updateCurrentDate() {
            const now = new Date();
            const day = now.getDate();
            const month = now.getMonth() + 1;
            const year = now.getFullYear();
            
            // Update date in history tab
            const dateElements = document.querySelectorAll('.current-day');
            dateElements.forEach(el => {
                if (parseInt(el.textContent) === day) {
                    el.textContent = day;
                }
            });
            
            // Update selected date text
            const dateText = document.getElementById('selected-date');
            if (dateText) {
                dateText.textContent = `Data selecionada: ${day.toString().padStart(2, '0')}/${month.toString().padStart(2, '0')}/${year}`;
            }
        }
    </script>
</body>
</html>